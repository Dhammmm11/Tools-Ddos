<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ Stress Test Toolkit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-900 text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-red-500 to-purple-600 bg-clip-text text-transparent">
                üöÄ ULTIMATE STRESS TEST TOOLKIT
            </h1>
            <p class="text-gray-400 mt-2">Professional Load Testing Interface</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Attack Control Panel -->
            <div class="lg:col-span-2 bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-red-400">
                    <i class="fas fa-rocket mr-2"></i>Attack Control Panel
                </h2>
                
                <!-- Target Configuration -->
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">üéØ Target URL</label>
                    <input type="text" id="targetUrl" 
                           class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg focus:border-red-500 focus:outline-none"
                           placeholder="http://example.com" value="http://localhost:8000">
                </div>

                <!-- Attack Parameters -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-gray-300 mb-2">üî• Concurrent Workers</label>
                        <input type="number" id="workers" 
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg"
                               value="100" min="1" max="10000">
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-2">‚è±Ô∏è Duration (seconds)</label>
                        <input type="number" id="duration" 
                               class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg"
                               value="60" min="1" max="3600">
                    </div>
                </div>

                <!-- Attack Type -->
                <div class="mb-6">
                    <label class="block text-gray-300 mb-2">üí• Attack Type</label>
                    <div class="grid grid-cols-2 gap-2">
                        <button class="attack-type-btn bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-red-500" data-type="http">
                            üèπ HTTP Flood
                        </button>
                        <button class="attack-type-btn bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-red-500" data-type="slowloris">
                            üêå Slowloris
                        </button>
                        <button class="attack-type-btn bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-red-500" data-type="post">
                            üì® POST Flood
                        </button>
                        <button class="attack-type-btn bg-gray-700 p-3 rounded-lg border border-gray-600 hover:border-red-500" data-type="multi">
                            üíÄ Multi-Vector
                        </button>
                    </div>
                </div>

                <!-- Control Buttons -->
                <div class="flex gap-4">
                    <button id="startAttack" 
                            class="flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 p-4 rounded-lg font-bold text-center transition-all">
                        üöÄ LAUNCH ATTACK
                    </button>
                    <button id="stopAttack" 
                            class="flex-1 bg-gray-700 hover:bg-gray-600 p-4 rounded-lg font-bold text-center transition-all">
                        ‚èπÔ∏è STOP ALL
                    </button>
                </div>

                <!-- Warning -->
                <div class="mt-6 p-4 bg-yellow-900 border border-yellow-700 rounded-lg">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <strong>Warning:</strong> Only use on websites you own. Illegal usage is prohibited.
                </div>
            </div>

            <!-- Real-time Stats -->
            <div class="bg-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-6 text-green-400">
                    <i class="fas fa-chart-bar mr-2"></i>Live Statistics
                </h2>
                
                <div id="statsContainer">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-chart-line text-4xl mb-2"></i>
                        <p>No active attacks</p>
                    </div>
                </div>

                <!-- Progress Bar -->
                <div class="mt-6">
                    <label class="block text-gray-300 mb-2">Attack Progress</label>
                    <div class="w-full bg-gray-700 rounded-full h-4">
                        <div id="progressBar" class="bg-red-600 h-4 rounded-full transition-all" style="width: 0%"></div>
                    </div>
                    <div id="progressText" class="text-right text-sm text-gray-400 mt-1">0%</div>
                </div>

                <!-- Active Attacks -->
                <div class="mt-6">
                    <h3 class="text-lg font-bold mb-3">Active Attacks</h3>
                    <div id="activeAttacks" class="space-y-2">
                        <!-- Active attacks will appear here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="mt-8 bg-gray-800 rounded-lg p-6">
            <h2 class="text-2xl font-bold mb-6 text-blue-400">
                <i class="fas fa-chart-line mr-2"></i>Performance Metrics
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <canvas id="requestsChart" width="400" height="200"></canvas>
                </div>
                <div>
                    <canvas id="successRateChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentAttackId = null;
        let statsInterval = null;
        let requestsChart = null;
        let successRateChart = null;

        // Initialize charts
        function initializeCharts() {
            const ctx1 = document.getElementById('requestsChart').getContext('2d');
            const ctx2 = document.getElementById('successRateChart').getContext('2d');

            requestsChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Requests/Second',
                        data: [],
                        borderColor: 'rgb(239, 68, 68)',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Requests Per Second'
                        }
                    }
                }
            });

            successRateChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Success', 'Failed'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: [
                            'rgb(34, 197, 94)',
                            'rgb(239, 68, 68)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Success Rate'
                        }
                    }
                }
            });
        }

        // Start attack
        document.getElementById('startAttack').addEventListener('click', async () => {
            const target = document.getElementById('targetUrl').value;
            const workers = document.getElementById('workers').value;
            const duration = document.getElementById('duration').value;

            if (!target) {
                alert('Please enter a target URL');
                return;
            }

            try {
                const response = await fetch('/api/start_attack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        target: target,
                        workers: workers,
                        duration: duration
                    })
                });

                const data = await response.json();
                
                if (data.status === 'started') {
                    currentAttackId = data.attack_id;
                    alert('Attack started successfully!');
                    startStatsMonitoring();
                }
            } catch (error) {
                alert('Error starting attack: ' + error.message);
            }
        });

        // Stop attack
        document.getElementById('stopAttack').addEventListener('click', async () => {
            if (!currentAttackId) {
                alert('No active attack to stop');
                return;
            }

            try {
                const response = await fetch('/api/stop_attack', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        attack_id: currentAttackId
                    })
                });

                const data = await response.json();
                alert(data.message);
                
                if (statsInterval) {
                    clearInterval(statsInterval);
                    statsInterval = null;
                }
            } catch (error) {
                alert('Error stopping attack: ' + error.message);
            }
        });

        // Monitor stats
        function startStatsMonitoring() {
            statsInterval = setInterval(async () => {
                try {
                    const response = await fetch('/api/stats');
                    const stats = await response.json();

                    updateStatsDisplay(stats);
                    updateCharts(stats);
                } catch (error) {
                    console.error('Error fetching stats:', error);
                }
            }, 1000);
        }

        // Update stats display
        function updateStatsDisplay(stats) {
            const container = document.getElementById('statsContainer');
            
            if (Object.keys(stats).length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-chart-line text-4xl mb-2"></i>
                        <p>No active attacks</p>
                    </div>
                `;
                return;
            }

            let html = '';
            for (const [attackId, data] of Object.entries(stats)) {
                html += `
                    <div class="bg-gray-700 p-4 rounded-lg mb-4">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">${attackId}</span>
                            <span class="px-2 py-1 bg-red-600 rounded text-xs">RUNNING</span>
                        </div>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>Requests: <span class="font-bold">${data.requests}</span></div>
                            <div>Success: <span class="font-bold text-green-400">${data.success}</span></div>
                            <div>RPS: <span class="font-bold">${data.rps.toFixed(1)}</span></div>
                            <div>Duration: <span class="font-bold">${data.duration.toFixed(1)}s</span></div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // Update charts
        function updateCharts(stats) {
            if (Object.keys(stats).length === 0) return;

            const data = Object.values(stats)[0]; // Get first attack stats
            
            // Update line chart
            const now = new Date().toLocaleTimeString();
            requestsChart.data.labels.push(now);
            requestsChart.data.datasets[0].data.push(data.rps);
            
            // Keep only last 10 data points
            if (requestsChart.data.labels.length > 10) {
                requestsChart.data.labels.shift();
                requestsChart.data.datasets[0].data.shift();
            }
            
            requestsChart.update();

            // Update doughnut chart
            const failed = data.requests - data.success;
            successRateChart.data.datasets[0].data = [data.success, failed];
            successRateChart.update();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            
            // Attack type buttons
            document.querySelectorAll('.attack-type-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.attack-type-btn').forEach(b => {
                        b.classList.remove('border-red-500', 'bg-red-900');
                    });
                    this.classList.add('border-red-500', 'bg-red-900');
                });
            });
        });
    </script>
</body>
</html>
